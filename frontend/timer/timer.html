<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <!-- Responsive meta tag-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>KnowTime - Timer</title>
      <link rel="icon" type="image/x-icon" href="../resources/tomato.png">
      <link rel="stylesheet" href="/frontend/styles.css">
      <link rel="stylesheet" href="timer.css">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      <!-- Barlow Font -->
      <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;700&display=swap" rel="stylesheet">
   </head>
   <body>
      <!-- Header Section -->
      <div id="header-common"></div>
      <script>
         fetch('../shared/header.html')
           .then(response => response.text())
           .then(data => {
             document.getElementById('header-common').innerHTML = data;
         
             const currentPath = window.location.pathname;
             console.log("Current Path:", currentPath);
         
             const navLinks = document.querySelectorAll(".nav-link, .dropdown-item");
         
             navLinks.forEach(link => {
               const pagePath = link.getAttribute("href");
         
               console.log("Checking link:", pagePath);
         
               if (currentPath.includes(pagePath)) {
                 console.log("Match found, adding active class to:", link);
         
                 link.classList.add("active");
         
                 if (link.classList.contains('dropdown-item')) {
                   const parentLink = link.closest('.dropdown').querySelector('.nav-link');
                   parentLink.classList.add('active');
                 }
               } else {
                 link.classList.remove("active");
               }
             });
           })
           .catch(error => {
             console.error('Error loading header:', error);
           });
      </script>
      <!-- Main Section -->
      <main class="container text-center mt-5">
         <div class="logo">
            <span style="font-size: 40px; font-weight: bold;">Pomodoro Timer</span>
            <img src="../resources/tomato.png" alt="tomato logo" style="width:60px; margin-bottom:25px";> <!-- Adjust the path if needed -->
         </div>
         <div class="timer">
            <div class="button-container">
               <button class="button" id="pomodoro-session" onClick="normalTimer()">Pomodoro</button>
               <button class="button" id="custom-pomdoro" onclick="customTimer()">Custom Pomodoro</button>
            </div>
            <div id="type" class="timer-type">Time to study!</div>
            <div id="pomodoro-timer" class="timer-display">25:00</div>
            <button id="start" class="button" onclick="startTimer()">START</button>
            <button id="start" class="button" onclick="pauseTimer()">PAUSE</button>
            <button id="stop" class="button" onclick="stopTimer()">STOP</button>
         </div>
      </main>
      <!-- Footer Section -->
      <div id="footer-common"></div>
      <script>
         fetch('../shared/footer.html')  <!-- Fetch footer -->
           .then(response => response.text())
           .then(data => {
             document.getElementById('footer-common').innerHTML = data;
           });
      </script>
   </body>
</html>
<script>
   let timeRemaining = 0;
   let timer = null;
   let isRunning = false;
   let originalTime = "";
   let breakTimeInMinutes = "5";
   let studyTimeInMinutes = "25";
   let currentMode = "study";
   
   function startTimer() {
     if(isRunning) {
       return;
     }
   
     isRunning = true;
   
     if(!originalTime) {
     originalTime = document.getElementById("pomodoro-timer").textContent;
     }
     if(timeRemaining === 0) {
      timeRemaining = parseInt(originalTime.split(":")[0]) * 60;
     }
   
     if(currentMode == "study") {
     document.getElementById("type").textContent = "Time to study!";
     } else if (currentMode === "break") {
      document.getElementById("type").textContent = "Time for a break!";
     }
   
     const timerElement = document.getElementById("pomodoro-timer").textContent;
   
     timer = setInterval(() => {
       const minutes = Math.floor(timeRemaining / 60);
       const seconds = timeRemaining % 60;
   
       const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
       const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
   
       document.getElementById("pomodoro-timer").textContent = `${formattedMinutes}:${formattedSeconds}`;
   
       if (timeRemaining === 0) {
         clearInterval(timer);
         isRunning = false;
         alert("Time's up!");

         if(currentMode === "break") {
         startStudy();
         } else if (currentMode === "study") {
          startBreak();
         }
       } else {
         timeRemaining--;
       }
     }, 1000);    
   }
   
   function customTimer() {
           studyTimeInMinutes = prompt("How many minutes would you like to study? (1-90 minutes)");
           while (isNaN(studyTimeInMinutes) || studyTimeInMinutes < 1 || studyTimeInMinutes > 90) {
            studyTimeInMinutes = prompt("How many minutes would you like to study? (1-90 minutes)");
           }
           if(studyTimeInMinutes < 10) {
            studyTimeInMinutes = "0" + studyTimeInMinutes;
           }
   
           breakTimeInMinutes = prompt("How many minutes would you like to take for a break? (1-30 minutes)");
           while (isNaN(breakTimeInMinutes) || breakTimeInMinutes < 1 || breakTimeInMinutes > 30) {
             breakTimeInMinutes = prompt("How many minutes would you like to take for a break? (1-30 minutes)");
           }
   
           document.getElementById("pomodoro-timer").textContent = studyTimeInMinutes.toString() + ":00";
           originalTime = document.getElementById("pomodoro-timer").textContent;
           timeRemaining = parseInt(originalTime.split(":")[0]) * 60;
   }

   function normalTimer() {   
           document.getElementById("pomodoro-timer").textContent = "25:00";
           originalTime = document.getElementById("pomodoro-timer").textContent;
           timeRemaining = parseInt(originalTime.split(":")[0]) * 60;
           breakTimeInMinutes = "5";
   }
   
   function stopTimer() {
   clearInterval(timer);
   isRunning = false;
   
   document.getElementById("pomodoro-timer").textContent = originalTime;
   timeRemaining = 0;
   originalTime = ""; 
   }
   
   function startBreak() {
     currentMode = "break";
     document.getElementById("type").textContent = "Time for a break!";
     document.getElementById("pomodoro-timer").textContent = breakTimeInMinutes < 10 ? "0" + breakTimeInMinutes + ":00" : breakTimeInMinutes + ":00";
     timeRemaining = parseInt(breakTimeInMinutes) * 60;
     startTimer();
   }

   function startStudy() {
     currentMode = "study";
     document.getElementById("type").textContent = "Time to study!";
     const studyMinutes = parseInt(studyTimeInMinutes.split(":")[0])
     document.getElementById("pomodoro-timer").textContent = studyMinutes < 10 ? "0" + studyMinutes + ":00" : studyMinutes + ":00";
     timeRemaining = studyMinutes * 60;
     startTimer();
   }
   
   function pauseTimer() {
      if (!isRunning) {
        return;
      }
   
      clearInterval(timer);
      isRunning = false;
   }
</script>